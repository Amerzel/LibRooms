<?phpsession_start();if(isset($_GET['logoff'])){	unset($_SESSION['LibRooms']);	header("location: ./");}if($requires_authentication){	// page requires authentication	// verify user is logged-in	if(!isset($_SESSION['LibRooms']['UserID']))	{		if(isset($_SESSION['barcode']))		{			// user has authenticated against III Patron API. Use patron id to create session.			$users = api("find_users_by_name_or_patron_id",array("patron_id"=>$_SESSION['barcode']));			if(count($users)==1)			{				foreach($users as $user)					break;									$_SESSION['LibRooms']['FirstName'] = $user->first_name;				$_SESSION['LibRooms']['LastName'] = $user->last_name;				$_SESSION['LibRooms']['UserID'] = $user->id;				$_SESSION['LibRooms']['PatronID'] = $user->patron_id;				$_SESSION['LibRooms']['Email'] = $user->email;				foreach($user->roles as $role)					$_SESSION['LibRooms']['Roles'][$role] = $role;			}		}				if(!isset($_SESSION['LibRooms']['UserID']))		{			// direct user to remote auth			header("location: ".REMOTE_AUTH."?redirect=".urlencode($_SERVER["PHP_SELF"]."?".$_SERVER["QUERY_STRING"]));		}	}}?>