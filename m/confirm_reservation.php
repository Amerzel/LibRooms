<?phpsession_start();require_once("config/config.inc.php");require_once("includes/functions.inc.php");if(isset($_GET['confirmed'])) $requires_authentication = true;require_once("includes/authentication.inc.php");$reschedule_id = $_GET['reschedule_id'];$selected_date = $_GET['selected_date'];$room_id = $_GET['room_id'];$room_id_parts = explode("_",$room_id);$start_time = $_GET['start_time'];$end_time = $_GET['end_time'];$confirmed = $_GET['confirmed'];if(isset($_GET['confirmed'])){	$errors = array();		// check for family friendly checkbox, if required (display error message if not checked)	if(!strcmp($room_id_parts[0],'21'))	{		if(strcmp($_GET['family_friendly_terms'],'on'))		{			$errors[] = "ERROR: You must agree to the terms for this room.";		}	}		if(count($errors) > 0)	{		foreach($errors as $error)			$_SESSION['LibRooms']['FlashError'] .= "<p>$errors</p>";	}	else	{		$users = api("find_users_by_name_or_patron_id",array("patron_id"=>$_SESSION['LibRooms']['PatronID']));				if(count($users)==1)		{			foreach($users as $user)				break;							// if reservation request confirmed, then create reservation and route user to the thank you page						$options = array();			$options["room_id"] = $room_id_parts[0];			$options["room_section_id"] = $room_id_parts[1];			$options["user_id"] = $user->id;			$options["selected_date"] = $selected_date;			$options["start_time"] = $start_time;			$options["end_time"] = $end_time;			$options["mobile"] = 1;			if(strcmp($reschedule_id,''))			{				$options["original_reservation_id"] = $reschedule_id;				$reservation_result = api("reschedule_reservation",$options);			}			else				$reservation_result = api("create_reservation",$options);			// if there was an error creating the reservation, display the error(s)			if(is_array($reservation_result))			{				foreach($reservation_result as $error)				{					$_SESSION['LibRooms']['FlashError'] .= "<p>ERROR: $error->message</p>";				}								$page_title = "ERROR";				require_once(THEME."header.php");								?>								<div id="list">					<center>					<div>						<h2>Room <?php print(ltrim($room->room_number,"0")); ?> (<?php print($room->capacity); ?> Chairs)</h2>						<table style='font-size:18px;'>						<tr><td width="100"><b>Date:</b></td><td align="left"><?php print(date("m/d/Y",strtotime($selected_date))); ?></td></tr>						<tr><td width="100"><b>Start Time:</b></td><td align="left"><?php print(date("g:ia",strtotime($start_time))); ?></td></tr>						<tr><td width="100"><b>End Time:</b></td><td align="left"><?php print(date("g:ia",strtotime($end_time))); ?></td></tr>						</table>						<a href="terms_and_conditions.php" style="font-size:18px;" data-rel="dialog">Terms and Conditions</a>						<?php							if(!strcmp($room_id_parts[0],'21'))							{								print("<label for=\"family_friendly_terms\">To use this special study room, I understand that I must have a child with me.</label>\n");								print("<input type=\"checkbox\" name=\"family_friendly_terms\" id=\"family_friendly_terms\" class=\"custom\" />\n");							}						?>					</div>					</center>				</div>								<p><a data-role="button" data-ajax="false" href='./'>Make a New Reservation</a></p>				<p><a data-role="button" data-ajax="false" href="account.php">View My Account</a></p>				<?php								require_once(THEME."footer.php");				exit();			}			else			{				// reservation made, go to thank you page				// print_r($options);				header("location: reservation_ty.php?reservation_id=$reservation_result");				exit();			}		}			}}// load rooms$all_rooms = api("load_rooms",array("id"=>$room_id_parts[0]));foreach($all_rooms as $room)	break;	$all_room_groups = api("load_room_groups");// load reservations$all_reservations = api("load_calendar_reservations",null,true);$page_title = "Reserve Now";require_once(THEME."header.php");?>				<form id="reservation_form" name="reservation_form" action="confirm_reservation.php" target="_self">				<input type="hidden" name="reschedule_id" value="<?php print($reschedule_id); ?>" />				<input type="hidden" name="selected_date" value="<?php print($selected_date); ?>" />				<input type="hidden" name="room_id" value="<?php print($room_id); ?>" />				<input type="hidden" name="start_time" value="<?php print($start_time); ?>" />				<input type="hidden" name="end_time" value="<?php print($end_time); ?>" />				<input type="hidden" name="confirmed" value="1" />				<div id="list">					<center>					<div>						<h2>Room <?php print(ltrim($room->room_number,"0")); ?> (<?php print($room->capacity); ?> Chairs)</h2>						<table style='font-size:18px;'>						<tr><td width="100"><b>Date:</b></td><td align="left"><?php print(date("m/d/Y",strtotime($selected_date))); ?></td></tr>						<tr><td width="100"><b>Start Time:</b></td><td align="left"><?php print(date("g:ia",strtotime($start_time))); ?></td></tr>						<tr><td width="100"><b>End Time:</b></td><td align="left"><?php print(date("g:ia",strtotime($end_time))); ?></td></tr>						</table>						<a href="terms_and_conditions.php" style="font-size:18px;" data-rel="dialog">Terms and Conditions</a>						<?php							if(!strcmp($room_id_parts[0],'21'))							{								print("<label for=\"family_friendly_terms\">To use this special study room, I understand that I must have a child with me.</label>\n");								print("<input type=\"checkbox\" name=\"family_friendly_terms\" id=\"family_friendly_terms\" class=\"custom\" />\n");							}						?>					</div>					</center>				</div>				<div id="find_a_room2" style="display:block">					<button id="find_a_room_button">Reserve Room</button>				</div>				</form>		<?php	// display amenities	if(count($room->amenities) > 0)	{		print("<h2>Amenities</h2>\n");		print("<ul>\n");		foreach($room->amenities as $amenity)		{			print("<li>$amenity->name</li>\n");		}		print("</ul>\n");	}		if(count($room->images->room) > 0)	{		foreach($room->images->room as $image)		{			//print("<div><img src='../$image->location' width='100%' style='opacity: 0.2; filter: alpha(opacity=40);' /></div>\n");			print("<a href='#image$image->id' data-rel='popup' data-position-to='window' data-role='button' data-theme='b' data-inline='true'><img src='../$image->location' alt='Room Image' border='0' width='90'></a>");			print("<div data-role='popup' id='image$image->id' class='photopopup' data-overlay-theme='a' data-corners='false' data-tolerance='30,15' ><a href='#' data-rel='back' data-role='button' data-theme='a' data-icon='delete' data-iconpos='notext' class='ui-btn-right'>Close</a><img src='../$image->location' alt='Room Image'></div>\n");		}	}							require_once(THEME."footer.php");				?>